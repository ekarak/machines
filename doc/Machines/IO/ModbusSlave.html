<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

	<title>Class: Machines::IO::ModbusSlave</title>

	<link rel="stylesheet" href="../../rdoc.css" type="text/css" media="screen" />

	<script src="../../js/jquery.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../../js/thickbox-compressed.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../../js/quicksearch.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../../js/darkfish.js" type="text/javascript"
		charset="utf-8"></script>

</head>
<body class="class">

	<div id="metadata">
		<div id="home-metadata">
			<div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../../index.html">Home</a>
          <a href="../../index.html#classes">Classes</a>
          <a href="../../index.html#methods">Methods</a>
        </h3>
			</div>
		</div>

		<div id="file-metadata">
			<div id="file-list-section" class="section">
				<h3 class="section-header">In Files</h3>
				<div class="section-body">
					<ul>
					
						<li><a href="../../lib/machines/io/modbus_slave_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
							class="thickbox" title="lib/machines/io/modbus_slave.rb">lib/machines/io/modbus_slave.rb</a></li>
					
					</ul>
				</div>
			</div>

			
		</div>

		<div id="class-metadata">

			<!-- Parent Class -->
			
			<div id="parent-class-section" class="section">
				<h3 class="section-header">Parent</h3>
				
				<p class="link"><a href="../../Object.html">Object</a></p>
				
			</div>
			

			<!-- Namespace Contents -->
			

			<!-- Method Quickref -->
			
			<div id="method-list-section" class="section">
				<h3 class="section-header">Methods</h3>
				<ul class="link-list">
					
					<li><a href="#method-c-new">::new</a></li>
					
					<li><a href="#method-i-block_groups">#block_groups</a></li>
					
					<li><a href="#method-i-bool_input">#bool_input</a></li>
					
					<li><a href="#method-i-bool_output">#bool_output</a></li>
					
					<li><a href="#method-i-communication_thread_start">#communication_thread_start</a></li>
					
					<li><a href="#method-i-consecutive_groups">#consecutive_groups</a></li>
					
					<li><a href="#method-i-filter_scangroup">#filter_scangroup</a></li>
					
					<li><a href="#method-i-handle_word_data">#handle_word_data</a></li>
					
					<li><a href="#method-i-input">#input</a></li>
					
					<li><a href="#method-i-number_from_address">#number_from_address</a></li>
					
					<li><a href="#method-i-output">#output</a></li>
					
					<li><a href="#method-i-perform_in_background">#perform_in_background</a></li>
					
					<li><a href="#method-i-type_from_address">#type_from_address</a></li>
					
					<li><a href="#method-i-update">#update</a></li>
					
					<li><a href="#method-i-update_helper">#update_helper</a></li>
					
					<li><a href="#method-i-word_input">#word_input</a></li>
					
					<li><a href="#method-i-word_output">#word_output</a></li>
					
				</ul>
			</div>
			

			<!-- Included Modules -->
			
		</div>

		<div id="project-metadata">
			
			
			<div id="fileindex-section" class="section project-section">
				<h3 class="section-header">Files</h3>
				<ul>
				
					<li class="file"><a href="../../History_txt.html">History.txt</a></li>
				
					<li class="file"><a href="../../Manifest_txt.html">Manifest.txt</a></li>
				
					<li class="file"><a href="../../PostInstall_txt.html">PostInstall.txt</a></li>
				
					<li class="file"><a href="../../README_rdoc.html">README.rdoc</a></li>
				
					<li class="file"><a href="../../README_rdoc~.html">README.rdoc~</a></li>
				
					<li class="file"><a href="../../Rakefile.html">Rakefile</a></li>
				
					<li class="file"><a href="../../Rakefile~.html">Rakefile~</a></li>
				
				</ul>
			</div>
			

			<div id="classindex-section" class="section project-section">
				<h3 class="section-header">Class Index
					<span class="search-toggle"><img src="../../images/find.png"
						height="16" width="16" alt="[+]"
						title="show/hide quicksearch" /></span></h3>
				<form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
				<fieldset>
					<legend>Quicksearch</legend>
					<input type="text" name="quicksearch" value=""
						class="quicksearch-field" />
				</fieldset>
				</form>

				<ul class="link-list">
				
					<li><a href="../../Machines.html">Machines</a></li>
				
					<li><a href="../../Machines/IO.html">Machines::IO</a></li>
				
					<li><a href="../../Machines/IO/IOAccess.html">Machines::IO::IOAccess</a></li>
				
					<li><a href="../../Machines/IO/ModbusSlave.html">Machines::IO::ModbusSlave</a></li>
				
					<li><a href="../../Machines/Physical.html">Machines::Physical</a></li>
				
					<li><a href="../../Machines/Physical/AnalogConstant.html">Machines::Physical::AnalogConstant</a></li>
				
					<li><a href="../../Machines/Physical/Interlock.html">Machines::Physical::Interlock</a></li>
				
					<li><a href="../../Machines/Physical/Motor.html">Machines::Physical::Motor</a></li>
				
					<li><a href="../../Machines/Physical/PID.html">Machines::Physical::PID</a></li>
				
					<li><a href="../../Machines/Physical/Valve.html">Machines::Physical::Valve</a></li>
				
					<li><a href="../../Machines/Sequences.html">Machines::Sequences</a></li>
				
					<li><a href="../../Machines/Sequences/ChooseOne.html">Machines::Sequences::ChooseOne</a></li>
				
					<li><a href="../../Machines/Sequences/InParallel.html">Machines::Sequences::InParallel</a></li>
				
					<li><a href="../../Machines/Sequences/Sequence.html">Machines::Sequences::Sequence</a></li>
				
					<li><a href="../../Machines/Sequences/StackSequence.html">Machines::Sequences::StackSequence</a></li>
				
					<li><a href="../../Machines/Sequences/Step.html">Machines::Sequences::Step</a></li>
				
					<li><a href="../../Machines/Sequences/StepBase.html">Machines::Sequences::StepBase</a></li>
				
					<li><a href="../../Machines/Sequences/WaitStep.html">Machines::Sequences::WaitStep</a></li>
				
					<li><a href="../../Machines/Timedomain.html">Machines::Timedomain</a></li>
				
					<li><a href="../../Machines/Timedomain/Analog.html">Machines::Timedomain::Analog</a></li>
				
					<li><a href="../../Machines/Timedomain/BinaryOpDiscrete.html">Machines::Timedomain::BinaryOpDiscrete</a></li>
				
					<li><a href="../../Machines/Timedomain/Discrete.html">Machines::Timedomain::Discrete</a></li>
				
					<li><a href="../../Machines/Timedomain/DiscreteBase.html">Machines::Timedomain::DiscreteBase</a></li>
				
					<li><a href="../../Machines/Timedomain/DiscreteSink.html">Machines::Timedomain::DiscreteSink</a></li>
				
					<li><a href="../../Machines/Timedomain/NegatedDiscrete.html">Machines::Timedomain::NegatedDiscrete</a></li>
				
					<li><a href="../../Machines/Timedomain/Sampler.html">Machines::Timedomain::Sampler</a></li>
				
					<li><a href="../../Machines/Timedomain/Scheduler.html">Machines::Timedomain::Scheduler</a></li>
				
					<li><a href="../../Machines/Timedomain/Scheduler/Entry.html">Machines::Timedomain::Scheduler::Entry</a></li>
				
					<li><a href="../../Machines/Timedomain/Scheduler/RealWaitPolicy.html">Machines::Timedomain::Scheduler::RealWaitPolicy</a></li>
				
					<li><a href="../../Machines/Timedomain/Scheduler/SkipWaitPolicy.html">Machines::Timedomain::Scheduler::SkipWaitPolicy</a></li>
				
					<li><a href="../../Machines/Timedomain/Timer.html">Machines::Timedomain::Timer</a></li>
				
					<li><a href="../../BeLogicalFalse.html">BeLogicalFalse</a></li>
				
					<li><a href="../../Notify.html">Notify</a></li>
				
					<li><a href="../../NotifyTestEmpty.html">NotifyTestEmpty</a></li>
				
					<li><a href="../../NotifyTestOne.html">NotifyTestOne</a></li>
				
					<li><a href="../../NotifyTestOneTwo.html">NotifyTestOneTwo</a></li>
				
					<li><a href="../../NotifyTestOneWithHandler.html">NotifyTestOneWithHandler</a></li>
				
					<li><a href="../../NotifyTestTwo.html">NotifyTestTwo</a></li>
				
					<li><a href="../../Object.html">Object</a></li>
				
				</ul>
				<div id="no-class-search-results" style="display: none;">No matching classes.</div>
			</div>

			
		</div>
	</div>

	<div id="documentation">
		<h1 class="class">Machines::IO::ModbusSlave</h1>

		<div id="description">
			<p>
All methods are assumed to perform in the Scheduler current thread
Performing requests are done in private threads and when the results  are
ready, they are added to the queue of scheduled tasks in the  Scheduler
</p>

		</div>

		<!-- Constants -->
		
		<div id="constants-list" class="section">
			<h3 class="section-header">Constants</h3>
			<dl>
			
				<dt><a name="ModbusEntry">ModbusEntry</a></dt>
				
				<dd class="description"></dd>
				
			
			</dl>
		</div>
		

		<!-- Attributes -->
		

		<!-- Methods -->
		
		<div id="public-class-method-details" class="method-section section">
			<h3 class="section-header">Public Class Methods</h3>

		
			<div id="new-method" class="method-detail ">
				<a name="method-c-new"></a>

				<div class="method-heading">
				
					<span class="method-name">new</span><span
						class="method-args">(options = {})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="new-source">
<pre>
    <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 18</span>
18:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">options</span> = {})
19:         <span class="ruby-comment cmt">#TODO timeout values?</span>
20:         <span class="ruby-ivar">@opts</span> = {
21:           <span class="ruby-value">:port</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">502</span>,
22:           <span class="ruby-value">:host</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'localhost'</span>,
23:           <span class="ruby-value">:slave_address</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>,
24:           <span class="ruby-value">:bool_block_size</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">128</span>,
25:           <span class="ruby-value">:word_block_size</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">128</span>,
26:           <span class="ruby-value">:threads</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
27:         }
28:         <span class="ruby-ivar">@opts</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-identifier">options</span>
29:         <span class="ruby-ivar">@bool_inputs</span> = <span class="ruby-constant">MultiRBTree</span>.<span class="ruby-identifier">new</span>
30:         <span class="ruby-ivar">@word_inputs</span> = <span class="ruby-constant">MultiRBTree</span>.<span class="ruby-identifier">new</span>
31:         <span class="ruby-ivar">@bool_outputs</span> = <span class="ruby-constant">MultiRBTree</span>.<span class="ruby-identifier">new</span>
32:         <span class="ruby-ivar">@word_outputs</span> = <span class="ruby-constant">MultiRBTree</span>.<span class="ruby-identifier">new</span>
33: 
34:         <span class="ruby-comment cmt"># Create a queue of Procs that call modbus functions in background</span>
35:         <span class="ruby-identifier">queue</span> = []
36:         <span class="ruby-identifier">queue</span>.<span class="ruby-identifier">extend</span> <span class="ruby-constant">MonitorMixin</span>
37:         <span class="ruby-ivar">@thread_tasks</span> = {
38:           <span class="ruby-value">:queue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">queue</span>,
39:           <span class="ruby-value">:cond</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">queue</span>.<span class="ruby-identifier">new_cond</span>
40:         }
41: 
42:         <span class="ruby-comment cmt"># Start the background threads</span>
43:         <span class="ruby-value">1</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:threads</span>]) <span class="ruby-keyword kw">do</span>
44:           <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span> <span class="ruby-keyword kw">do</span>
45:             <span class="ruby-identifier">communication_thread_start</span>
46:           <span class="ruby-keyword kw">end</span>
47:         <span class="ruby-keyword kw">end</span>
48:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="public-instance-method-details" class="method-section section">
			<h3 class="section-header">Public Instance Methods</h3>

		
			<div id="input-method" class="method-detail ">
				<a name="method-i-input"></a>

				<div class="method-heading">
				
					<span class="method-name">input</span><span
						class="method-args">(address, options={})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="input-source">
<pre>
    <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 50</span>
50:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">input</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">options</span>={})
51:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">type_from_address</span> <span class="ruby-identifier">address</span>
52:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">:int</span>
53:           <span class="ruby-identifier">word_input</span> <span class="ruby-identifier">address</span>, <span class="ruby-identifier">options</span>
54:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">:bool</span>
55:           <span class="ruby-identifier">bool_input</span> <span class="ruby-identifier">address</span>, <span class="ruby-identifier">options</span>
56:         <span class="ruby-keyword kw">end</span>
57:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="output-method" class="method-detail ">
				<a name="method-i-output"></a>

				<div class="method-heading">
				
					<span class="method-name">output</span><span
						class="method-args">(signal, address, options={})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="output-source">
<pre>
    <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 59</span>
59:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">output</span>(<span class="ruby-identifier">signal</span>, <span class="ruby-identifier">address</span>, <span class="ruby-identifier">options</span>={})
60:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">type_from_address</span> <span class="ruby-identifier">address</span>
61:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">:int</span>
62:           <span class="ruby-identifier">word_output</span> <span class="ruby-identifier">signal</span>, <span class="ruby-identifier">address</span>, <span class="ruby-identifier">options</span>
63:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">:bool</span>
64:           <span class="ruby-identifier">bool_output</span> <span class="ruby-identifier">signal</span>, <span class="ruby-identifier">address</span>, <span class="ruby-identifier">options</span>
65:         <span class="ruby-keyword kw">end</span>
66:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="update-method" class="method-detail ">
				<a name="method-i-update"></a>

				<div class="method-heading">
				
					<span class="method-name">update</span><span
						class="method-args">(filter = :all)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="update-source">
<pre>
     <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 68</span>
 68:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>(<span class="ruby-identifier">filter</span> = <span class="ruby-value">:all</span>)
 69:         <span class="ruby-comment cmt">#TODO Should have an option to autoreset written bits</span>
 70:         <span class="ruby-comment cmt">#TODO Should frist write all output groups, then wait before reading</span>
 71:         <span class="ruby-comment cmt">#TODO For bool values written support options :only_re, :only_fe, :always, :only_change</span>
 72:         <span class="ruby-comment cmt">#TODO Must support buffering of writes for bool and int values :only_change/:always</span>
 73:         <span class="ruby-comment cmt">#FIXME Bug since values must be read from the signals in main thread, FIXED, TEST!</span>
 74:         <span class="ruby-identifier">values_generator</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span><span class="ruby-operator">|</span> 
 75:           <span class="ruby-ivar">@bool_outputs</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-identifier">group</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">?</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>}
 76:         <span class="ruby-keyword kw">end</span>
 77:         <span class="ruby-identifier">update_helper</span>(<span class="ruby-ivar">@bool_outputs</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-value">:consecutive_groups</span>, <span class="ruby-identifier">values_generator</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span>, <span class="ruby-identifier">conn</span>, <span class="ruby-identifier">values</span><span class="ruby-operator">|</span>
 78:           <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">write_multiple_coils</span>(<span class="ruby-identifier">group</span>.<span class="ruby-identifier">first</span>, <span class="ruby-identifier">values</span>)
 79:         <span class="ruby-keyword kw">end</span>
 80: 
 81:         <span class="ruby-identifier">values_generator</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span><span class="ruby-operator">|</span> 
 82:           <span class="ruby-ivar">@bool_outputs</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-identifier">group</span>)
 83:         <span class="ruby-keyword kw">end</span>
 84:         <span class="ruby-identifier">update_helper</span>(<span class="ruby-ivar">@word_outputs</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-value">:consecutive_groups</span>, <span class="ruby-identifier">values_generator</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span>, <span class="ruby-identifier">conn</span>, <span class="ruby-identifier">values</span><span class="ruby-operator">|</span>
 85:           <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">write_multiple_registers</span>(<span class="ruby-identifier">group</span>.<span class="ruby-identifier">first</span>, <span class="ruby-identifier">values</span>)
 86:         <span class="ruby-keyword kw">end</span>
 87: 
 88:         <span class="ruby-identifier">update_helper</span>(<span class="ruby-ivar">@bool_inputs</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-value">:block_groups</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span>, <span class="ruby-identifier">connection</span><span class="ruby-operator">|</span>
 89:           <span class="ruby-identifier">values</span> = <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">read_multiple_coils</span>(<span class="ruby-identifier">group</span>.<span class="ruby-identifier">first</span>, <span class="ruby-identifier">group</span>.<span class="ruby-identifier">count</span>)
 90:           <span class="ruby-constant">Scheduler</span>.<span class="ruby-identifier">at_once</span> <span class="ruby-keyword kw">do</span>
 91:             <span class="ruby-ivar">@bool_inputs</span>.<span class="ruby-identifier">bound</span>(<span class="ruby-identifier">group</span>.<span class="ruby-identifier">first</span>, <span class="ruby-identifier">group</span>.<span class="ruby-identifier">last</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">address</span>, <span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
 92:               <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">signal</span>.<span class="ruby-identifier">v</span> = (<span class="ruby-identifier">values</span>[<span class="ruby-identifier">address</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">first</span>] <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">false</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">true</span>)
 93:             <span class="ruby-keyword kw">end</span>
 94:           <span class="ruby-keyword kw">end</span>
 95:         <span class="ruby-keyword kw">end</span>
 96: 
 97:         <span class="ruby-identifier">update_helper</span>(<span class="ruby-ivar">@word_inputs</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-value">:block_groups</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span>, <span class="ruby-identifier">connection</span><span class="ruby-operator">|</span>
 98:           <span class="ruby-identifier">values</span> = <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">read_multiple_registers</span>(<span class="ruby-identifier">group</span>.<span class="ruby-identifier">first</span>, <span class="ruby-identifier">group</span>.<span class="ruby-identifier">count</span>)
 99:           <span class="ruby-constant">Scheduler</span>.<span class="ruby-identifier">at_once</span> <span class="ruby-keyword kw">do</span> 
100:             <span class="ruby-ivar">@word_inputs</span>.<span class="ruby-identifier">bound</span>(<span class="ruby-identifier">group</span>.<span class="ruby-identifier">first</span>, <span class="ruby-identifier">group</span>.<span class="ruby-identifier">last</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">address</span>, <span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
101:               <span class="ruby-identifier">handle_word_data</span>(<span class="ruby-identifier">address</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">first</span>, <span class="ruby-identifier">entry</span>, <span class="ruby-identifier">values</span>)
102:             <span class="ruby-keyword kw">end</span>
103:           <span class="ruby-keyword kw">end</span>
104:         <span class="ruby-keyword kw">end</span>
105:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="private-instance-method-details" class="method-section section">
			<h3 class="section-header">Private Instance Methods</h3>

		
			<div id="block-groups-method" class="method-detail ">
				<a name="method-i-block_groups"></a>

				<div class="method-heading">
				
					<span class="method-name">block_groups</span><span
						class="method-args">(entries, max_block_size)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="block-groups-source">
<pre>
     <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 169</span>
169:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">block_groups</span>(<span class="ruby-identifier">entries</span>, <span class="ruby-identifier">max_block_size</span>)
170:         <span class="ruby-identifier">result</span> = []
171:         <span class="ruby-identifier">start</span> = <span class="ruby-value">0</span>
172:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">start</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">entries</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">first</span> <span class="ruby-comment cmt"># last key</span>
173:           <span class="ruby-identifier">start</span> = <span class="ruby-identifier">entries</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">first</span> <span class="ruby-comment cmt"># first key</span>
174:           <span class="ruby-identifier">ub</span> = <span class="ruby-identifier">entries</span>.<span class="ruby-identifier">upper_bound</span> <span class="ruby-identifier">start</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">max_block_size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
175:           <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">start</span><span class="ruby-operator">..</span><span class="ruby-identifier">ub</span>
176:           <span class="ruby-identifier">start</span> = <span class="ruby-identifier">entries</span>.<span class="ruby-identifier">lower_bound</span>(<span class="ruby-identifier">ub</span>).<span class="ruby-identifier">first</span> <span class="ruby-comment cmt"># next key after ub</span>
177:         <span class="ruby-keyword kw">end</span>
178:         <span class="ruby-identifier">result</span>
179:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="bool-input-method" class="method-detail ">
				<a name="method-i-bool_input"></a>

				<div class="method-heading">
				
					<span class="method-name">bool_input</span><span
						class="method-args">(address, options)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="bool-input-source">
<pre>
     <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 188</span>
188:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bool_input</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">options</span>)
189:         <span class="ruby-identifier">result</span> = <span class="ruby-constant">Machines</span><span class="ruby-operator">::</span><span class="ruby-constant">TimeDomain</span><span class="ruby-operator">::</span><span class="ruby-constant">DiscreteSignal</span>.<span class="ruby-identifier">new</span>
190:         <span class="ruby-ivar">@bool_inputs</span>[<span class="ruby-identifier">number_from_address</span>(<span class="ruby-identifier">address</span>)] = 
191:           <span class="ruby-constant">ModbusEntry</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">result</span>, <span class="ruby-value">:bool</span>, <span class="ruby-identifier">options</span>[<span class="ruby-value">:scangroup</span>])
192:         <span class="ruby-identifier">result</span>
193:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="bool-output-method" class="method-detail ">
				<a name="method-i-bool_output"></a>

				<div class="method-heading">
				
					<span class="method-name">bool_output</span><span
						class="method-args">(source, address, options)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="bool-output-source">
<pre>
     <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 202</span>
202:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bool_output</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">address</span>, <span class="ruby-identifier">options</span>)
203:         <span class="ruby-identifier">addr</span> = <span class="ruby-identifier">number_from_address</span>(<span class="ruby-identifier">address</span>)
204:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@bool_outputs</span>.<span class="ruby-identifier">key?</span> <span class="ruby-identifier">addr</span> 
205:           <span class="ruby-identifier">throw</span> <span class="ruby-constant">RuntimeError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'Output on bool address %d is already in use'</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">addr</span>) 
206:         <span class="ruby-keyword kw">end</span>
207:         <span class="ruby-ivar">@bool_outputs</span>[<span class="ruby-identifier">addr</span>] = <span class="ruby-constant">ModbusEntry</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">source</span>, <span class="ruby-value">:bool</span>, <span class="ruby-identifier">options</span>[<span class="ruby-value">:scangroup</span>]
208:         <span class="ruby-identifier">source</span>
209:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="communication-thread-start-method" class="method-detail ">
				<a name="method-i-communication_thread_start"></a>

				<div class="method-heading">
				
					<span class="method-name">communication_thread_start</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="communication-thread-start-source">
<pre>
     <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 236</span>
236:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">communication_thread_start</span>
237:         <span class="ruby-keyword kw">while</span> <span class="ruby-keyword kw">true</span>
238:           <span class="ruby-keyword kw">begin</span>
239:             <span class="ruby-identifier">connection</span> = <span class="ruby-constant">RModbus</span><span class="ruby-operator">::</span><span class="ruby-constant">TCPClient</span>.<span class="ruby-identifier">new</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:host</span>], <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:port</span>], <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:slave_address</span>]
240:             <span class="ruby-ivar">@thread_tasks</span>[<span class="ruby-value">:queue</span>].<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
241:               <span class="ruby-ivar">@thread_tasks</span>[<span class="ruby-value">:cond</span>].<span class="ruby-identifier">wait_while</span> { <span class="ruby-ivar">@thread_tasks</span>[<span class="ruby-value">:queue</span>].<span class="ruby-identifier">empty?</span> }
242:               <span class="ruby-keyword kw">begin</span>
243:                 <span class="ruby-ivar">@thread_tasks</span>[<span class="ruby-value">:queue</span>].<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">connection</span>)
244:               <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>
245:                 <span class="ruby-identifier">notify_exception</span> <span class="ruby-identifier">ex</span>
246:               <span class="ruby-keyword kw">end</span>
247:             <span class="ruby-keyword kw">end</span>
248:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>
249:             <span class="ruby-identifier">notify_exception</span> <span class="ruby-identifier">ex</span>
250:             <span class="ruby-identifier">sleep</span>(<span class="ruby-value">10.0</span> <span class="ruby-operator">+</span> <span class="ruby-value">5.0</span> * <span class="ruby-identifier">rand</span>)
251:           <span class="ruby-keyword kw">end</span>
252:         <span class="ruby-keyword kw">end</span>
253:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="consecutive-groups-method" class="method-detail ">
				<a name="method-i-consecutive_groups"></a>

				<div class="method-heading">
				
					<span class="method-name">consecutive_groups</span><span
						class="method-args">(entries)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="consecutive-groups-source">
<pre>
     <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 151</span>
151:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">consecutive_groups</span>(<span class="ruby-identifier">entries</span>)
152:         <span class="ruby-comment cmt"># Calc difference of addresses in list</span>
153:         <span class="ruby-identifier">diff</span> = []        
154:         <span class="ruby-identifier">entries</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each_cons</span>(<span class="ruby-value">2</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">diff</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">-</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">0</span>] }
155:         
156:         <span class="ruby-comment cmt"># Remember indices where difference is not one</span>
157:         <span class="ruby-identifier">gaps</span> = [<span class="ruby-value">0</span>]
158:         <span class="ruby-identifier">diff</span>.<span class="ruby-identifier">each_with_index</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">d</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">gaps</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">d</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> }
159:         <span class="ruby-identifier">gaps</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
160: 
161:         <span class="ruby-comment cmt"># Create ranges for indices from one gap to the next</span>
162:         <span class="ruby-identifier">result</span> = []
163:         <span class="ruby-identifier">gaps</span>.<span class="ruby-identifier">each_cons</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
164:           <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">0</span>]<span class="ruby-operator">..</span>(<span class="ruby-identifier">a</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">-</span> <span class="ruby-value">1</span>)
165:         <span class="ruby-keyword kw">end</span>
166:         <span class="ruby-identifier">result</span>
167:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="filter-scangroup-method" class="method-detail ">
				<a name="method-i-filter_scangroup"></a>

				<div class="method-heading">
				
					<span class="method-name">filter_scangroup</span><span
						class="method-args">(entries, filter)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="filter-scangroup-source">
<pre>
     <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 141</span>
141:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filter_scangroup</span>(<span class="ruby-identifier">entries</span>, <span class="ruby-identifier">filter</span>)
142:         <span class="ruby-comment cmt"># TODO filters :inputs, :outputs, :standard (nil), :constants</span>
143:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">filter</span>
144:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">:all</span>
145:           <span class="ruby-identifier">entries</span>
146:         <span class="ruby-keyword kw">else</span>
147:           <span class="ruby-constant">MultiRBTree</span>[<span class="ruby-identifier">entries</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">en</span><span class="ruby-operator">|</span> <span class="ruby-identifier">en</span>.<span class="ruby-identifier">filter</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">filter</span> }]
148:         <span class="ruby-keyword kw">end</span>
149:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="handle-word-data-method" class="method-detail ">
				<a name="method-i-handle_word_data"></a>

				<div class="method-heading">
				
					<span class="method-name">handle_word_data</span><span
						class="method-args">(address, entry, raw_data)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="handle-word-data-source">
<pre>
     <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 109</span>
109:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_word_data</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">entry</span>, <span class="ruby-identifier">raw_data</span>)
110:         <span class="ruby-comment cmt">#TODO Only supporting :int as yet</span>
111:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">format</span>
112:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">:int</span>
113:           <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">signal</span>.<span class="ruby-identifier">v</span> = <span class="ruby-identifier">values</span>[<span class="ruby-identifier">address</span>]
114:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">:uint</span>
115:           <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">signal</span>.<span class="ruby-identifier">v</span> = <span class="ruby-identifier">values</span>[<span class="ruby-identifier">address</span>] &amp; <span class="ruby-value">0xffff</span>
116:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">:long</span>
117:           <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">signal</span>.<span class="ruby-identifier">v</span> = <span class="ruby-identifier">values</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-identifier">address</span><span class="ruby-operator">..</span>(<span class="ruby-identifier">address</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>)).<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'u*'</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'i'</span>)
118:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">:float</span>
119:           <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">signal</span>.<span class="ruby-identifier">v</span> = <span class="ruby-identifier">values</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-identifier">address</span><span class="ruby-operator">..</span>(<span class="ruby-identifier">address</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>)).<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'u*'</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'g'</span>)
120:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">:string</span>
121:           <span class="ruby-identifier">throw</span> <span class="ruby-constant">RuntimeError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'No :length supplied for string value'</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">length</span>
122:           <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">signal</span>.<span class="ruby-identifier">v</span> = <span class="ruby-identifier">values</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-identifier">address</span><span class="ruby-operator">..</span>(<span class="ruby-identifier">address</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">length</span>)).<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'u*'</span>)
123:         <span class="ruby-keyword kw">else</span>
124:           <span class="ruby-identifier">throw</span> <span class="ruby-constant">RuntimeError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'Unsupported format :%s'</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">format</span>.<span class="ruby-identifier">to_s</span>)
125:         <span class="ruby-keyword kw">end</span>
126:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="number-from-address-method" class="method-detail ">
				<a name="method-i-number_from_address"></a>

				<div class="method-heading">
				
					<span class="method-name">number_from_address</span><span
						class="method-args">(address)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="number-from-address-source">
<pre>
     <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 221</span>
221:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">number_from_address</span>(<span class="ruby-identifier">address</span>)
222:         <span class="ruby-identifier">address</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp re">/\d+/</span>)[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_i</span>
223:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="perform-in-background-method" class="method-detail ">
				<a name="method-i-perform_in_background"></a>

				<div class="method-heading">
				
					<span class="method-name">perform_in_background</span><span
						class="method-args">(&task)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="perform-in-background-source">
<pre>
     <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 181</span>
181:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">perform_in_background</span>(&amp;<span class="ruby-identifier">task</span>) 
182:         <span class="ruby-ivar">@thread_tasks</span>[<span class="ruby-value">:queue</span>].<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
183:           <span class="ruby-ivar">@thread_tasks</span>[<span class="ruby-value">:queue</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">task</span>
184:           <span class="ruby-ivar">@thread_tasks</span>[<span class="ruby-value">:cond</span>].<span class="ruby-identifier">signal</span>
185:         <span class="ruby-keyword kw">end</span>
186:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="type-from-address-method" class="method-detail ">
				<a name="method-i-type_from_address"></a>

				<div class="method-heading">
				
					<span class="method-name">type_from_address</span><span
						class="method-args">(address)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="type-from-address-source">
<pre>
     <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 225</span>
225:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">type_from_address</span>(<span class="ruby-identifier">address</span>)
226:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">address</span>.<span class="ruby-identifier">to_s</span>
227:         <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/%?mw(\d+)/</span>
228:           <span class="ruby-value">:int</span>
229:         <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/%?m(\d+)/</span>
230:           <span class="ruby-value">:bool</span>
231:         <span class="ruby-keyword kw">else</span>
232:           <span class="ruby-identifier">throw</span> <span class="ruby-constant">RuntimeError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'Invalid format for address, use :mw1 or :m1'</span>)
233:         <span class="ruby-keyword kw">end</span>
234:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="update-helper-method" class="method-detail ">
				<a name="method-i-update_helper"></a>

				<div class="method-heading">
				
					<span class="method-name">update_helper</span><span
						class="method-args">(entries, filter, group_method, val_generator = nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="update-helper-source">
<pre>
     <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 128</span>
128:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_helper</span>(<span class="ruby-identifier">entries</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">group_method</span>, <span class="ruby-identifier">val_generator</span> = <span class="ruby-keyword kw">nil</span>) <span class="ruby-comment cmt"># do</span>
129:         <span class="ruby-identifier">send</span>(<span class="ruby-identifier">group_method</span>, <span class="ruby-identifier">filter_scangroup</span>(<span class="ruby-identifier">entries</span>, <span class="ruby-identifier">filter</span>)).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span><span class="ruby-operator">|</span>
130:           <span class="ruby-identifier">values</span> = <span class="ruby-identifier">val_generator</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val_generator</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">group</span>)
131:           <span class="ruby-identifier">perform_in_background</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">connection</span><span class="ruby-operator">|</span>
132:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">values</span>
133:               <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">group</span>, <span class="ruby-identifier">connection</span>, <span class="ruby-identifier">values</span>
134:             <span class="ruby-keyword kw">else</span>
135:               <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">group</span>, <span class="ruby-identifier">connection</span>
136:             <span class="ruby-keyword kw">end</span>
137:           <span class="ruby-keyword kw">end</span>
138:         <span class="ruby-keyword kw">end</span>
139:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="word-input-method" class="method-detail ">
				<a name="method-i-word_input"></a>

				<div class="method-heading">
				
					<span class="method-name">word_input</span><span
						class="method-args">(address, options)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="word-input-source">
<pre>
     <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 195</span>
195:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">word_input</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">options</span>)
196:         <span class="ruby-identifier">result</span> = <span class="ruby-constant">Machines</span><span class="ruby-operator">::</span><span class="ruby-constant">TimeDomain</span><span class="ruby-operator">::</span><span class="ruby-constant">AnalogSignal</span>.<span class="ruby-identifier">new</span> 
197:         <span class="ruby-ivar">@bool_inputs</span>[<span class="ruby-identifier">number_from_address</span>(<span class="ruby-identifier">address</span>)] = 
198:           <span class="ruby-constant">ModbusEntry</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">result</span>, <span class="ruby-identifier">options</span>[<span class="ruby-value">:format</span>] <span class="ruby-operator">||</span> <span class="ruby-value">:int</span>, <span class="ruby-identifier">options</span>[<span class="ruby-value">:scangroup</span>], <span class="ruby-identifier">options</span>[<span class="ruby-value">:length</span>])
199:         <span class="ruby-identifier">result</span>
200:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="word-output-method" class="method-detail ">
				<a name="method-i-word_output"></a>

				<div class="method-heading">
				
					<span class="method-name">word_output</span><span
						class="method-args">(source, address, options)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="word-output-source">
<pre>
     <span class="ruby-comment cmt"># File lib/machines/io/modbus_slave.rb, line 211</span>
211:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">word_output</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">address</span>, <span class="ruby-identifier">options</span>)
212:         <span class="ruby-identifier">addr</span> = <span class="ruby-identifier">number_from_address</span>(<span class="ruby-identifier">address</span>)
213:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@word</span>.<span class="ruby-identifier">key?</span> <span class="ruby-identifier">addr</span> 
214:           <span class="ruby-identifier">throw</span> <span class="ruby-constant">RuntimeError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'Output on word address %d is already in use'</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">addr</span>)
215:         <span class="ruby-keyword kw">end</span>
216:         <span class="ruby-ivar">@word_outputs</span>[<span class="ruby-identifier">addr</span>] = 
217:           <span class="ruby-constant">ModbusEntry</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">source</span>, <span class="ruby-identifier">options</span>[<span class="ruby-value">:format</span>] <span class="ruby-operator">||</span> <span class="ruby-value">:int</span>, <span class="ruby-identifier">options</span>[<span class="ruby-value">:scangroup</span>], <span class="ruby-identifier">options</span>[<span class="ruby-value">:length</span>]
218:         <span class="ruby-identifier">source</span>
219:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	

	</div>


	<div id="rdoc-debugging-section-dump" class="debugging-section">
	
		<p>Disabled; run with --debug to generate this.</p>
	
	</div>

	<div id="validator-badges">
		<p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
		<p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
			Rdoc Generator</a> 1.1.6</small>.</p>
	</div>

</body>
</html>

